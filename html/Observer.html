<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <link rel="shortcut icon" href="../ico/a-level-20.png" type="image/x-icon">
    <title>JS</title>
    <link rel="stylesheet" href="../src/style.css">
    <script src="../src/rainbow.js"></script>
    <link rel="stylesheet" href="../src/rainbow.css">
  </head>

  <body>
    <div class="main">
      <h1>Паттерны проектирования</h1>
      <h2><span class="ico-25 icon"></span>Observer</h2>
      <p>Разберем конкретную ситуацию, в которой можно применить этот паттерн</p>
      <p>Есть модель - это данные, которые динамически обновляются</p>
      <p>Есть представление - данные должны отображаться пользователю</p>
      <p>Нужно обеспечить реактивность приложения, т.е. отображение должно оперативно обновляться при обновлении данных модели</p>
      <p>При этом модули должны быть независимы</p>
      <p>Как оповестить модуль, отвечающий за представление, об изменении данных модели ?</p>
      <sample-element file="../src/samples/Observer-1.js" header="JS" lang="js"></sample-element>
      <p>функция, создающая и вставляющая элемент на страницу:</p>
      <sample-element file="../src/samples/Observer-2.js" header="JS" lang="js"></sample-element>
      <p>Создадим массив элементов <b><code>input</code></b>:</p>
      <sample-element file="../src/samples/Observer-3.js" header="JS" lang="js"></sample-element>
      <p>Итак, пользователь может в любой момент изменить данные модели</p>
      <hr/>
      <p>Давайте создадим представление и стилизуем его:</p>
      <sample-element file="../src/samples/Observer-4.js" header="Subscriber" lang="js"></sample-element>
      <!-- <p>можно даже стилизовать этот элемент:</p>
      <sample-element file="../src/samples/Observer-5.js" header="JS" lang="js"></sample-element> -->
      <p>Будем отображать в <b><code>subscriber</code></b> данные, которые пользователь вводит в поля <b><code>input</code></b></p>
      <p>Для этого создадим ему метод <b><code>showInfo</code></b></p>
      <sample-element file="../src/samples/Observer-6.js" header="JS" lang="js"></sample-element>
      <p>Этому методу передается объект <b><code>data</code></b>, в котором содержатся данные модели</p>
      <p>Метод обновляет контент элемента <b><code>subscriber</code></b></p>
      <p>Осталось только "подписать" <b><code>subscriber</code></b> на обновления данных модели</p>
      <hr/>
      <p>Создадим класс <b><code>Observer</code></b>:</p>
      <sample-element file="../src/samples/Observer-7.js" header="Observer" lang="js"></sample-element>
      <p>Конструктору класса <b><code>Observer</code></b> передается массив <b><code>subjects</code></b></p>
      <p>Это массив ссылок на элементы <em><code>input</code></em>, которые обозреватель будет отслеживать</p>
      <p>при изменении значений элементов обозреватель должен оповестить всех подписчиков об обновлении данных и передать им обновленные данные</p>
      <p><small>Подписчики - это функции, которые нужно будет вызвать при изменении данных модели</small></p>
      <p><small>Ссылки на них будут храниться в массиве <b><em><code>subscribers</code></em></b></small></p>
      <li>Для того, чтобы подписаться на уведомления обозревателя, нужно вызвать его метод <em><code>subscibe</code></em></li>
      <li>Для того, чтобы отписаться от уведомлений обозревателя, нужно вызвать его метод <em><code>unsubscibe</code></em></li>
      <li>Для оповещения подписчиков есть метод <em><code>broadcast</code></em></li>
      <p>Осталось только создать экземпляр обозревателя <b><code>observer</code></b>, передав ему ссылки на отслеживаемые элементы <b><em><code>observed</code></em></b>:</p>
      <sample-element file="../src/samples/Observer-8.js" header="JS" lang="js"></sample-element>
      <p>и подписать на его оповещения наше представление <b><code>subscriber</code></b>:</p>
      <sample-element file="../src/samples/Observer-9.js" header="JS" lang="js"></sample-element>
      <p>Тееперь при изменении значений в полях <b><em><code>input</code></em></b> созданное нами представление <b><code>subscriber</code></b> будет реактивно обновляться:</p>
      <div style="text-align: center">
          <img src="https://github.com/garevna/js-course/blob/master/pictures/observer-1.gif?raw=true" width="500"/>
      </div>
      <p></p>
      <h4>Полный код сниппета:</h4>
      <sample-element file="../src/samples/Observer.js" header="Pattern 'Observer'" lang="js"></sample-element>
      <div style="text-align: center">
          <img src="https://github.com/garevna/js-course/blob/master/pictures/observer-2.gif?raw=true" width="500"/>
      </div>
    </div>
    <script src="../src/component.js"></script>
  </body>

</html>
